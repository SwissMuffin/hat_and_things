# 03. Scheduling things



In this unit we're going to look at how we can use JavaScript to execute a function at a known point in the future.  We'll also see how we can  write JavaScript code that will repeatedly execute the same function at  regular intervals.  Both of these built-in features a particular use for *callbacks*, so it'll also be a great opportunity to think some more about how to use callbacks.

## Time out!

JavaScript includes a built-in function called `setTimeout` that allows us to execute a function at some point in the future.  We use `setTimeout` by passing it the function to execute and the amount of time to wait  before executing it, in milliseconds.  Let's look at a simple, but  annoying, example that displays an alert:

<iframe scrolling="no" title="328a547816e98b627850c9f9505347a0" src="https://codepen.io/exts/embed/preview/328a547816e98b627850c9f9505347a0/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/328a547816e98b627850c9f9505347a0/'&gt;328a547816e98b627850c9f9505347a0&lt;/a&gt;
 by EPFL Extension School (&lt;a 
href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

This example passes `setTimeout()` an *anonymous function* that will display an alert with the text `'Time is up!'`, and an integer `2000`.  This means that our little script above will display an alert two seconds (2000 milliseconds) after the `setTimeout()` function is executed.

We can pass `setTimeout()` any other function.  For example, we might have a function assigned to a variable called `echo`, like this:

<iframe scrolling="no" title="A timeout using a function variable" src="https://codepen.io/exts/embed/preview/f898ee0512fc6d5cb37174e23c7a8f04/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/f898ee0512fc6d5cb37174e23c7a8f04/'&gt;A
 timeout using a function variable&lt;/a&gt; by EPFL Extension School 
(&lt;a href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

This sets the text in an HTML `<p>` three seconds after `setTimeout` is executed.  The *JavaScript engine*, the part of the browser that executes all JavaScript code, will make a note that `echo` needs to be executed three thousand milliseconds after `setTimeout` is executed, and then execute `echo` once that time has passed.

We can queue up as many future events as we want using `setTimeout()`.  Let's look at a more advanced example that binds *two* uses of `setTimeout` to the `'click'` event on a button.

<iframe scrolling="no" title="Two timeouts" src="https://codepen.io/exts/embed/85754b639227449fbfd0d7386e74033f/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/85754b639227449fbfd0d7386e74033f/'&gt;Two
 timeouts&lt;/a&gt; by EPFL Extension School (&lt;a 
href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

This sample code binds a function to the `'click'` event of the `'#shout'` button.  When the button is clicked, two anonymous functions are stored with different timeouts.  JavaScript effectively sets a timer for each, so that they will both be executed at the correct point in the future,  i.e. one and a half second for the first, and four seconds for the  second.  See how many "echoes" you can get queued up in that example;  you'll need to type fast!

We can set timeouts for as many events as we like in JavaScript.  We  should make sure that we don't try to set too many as this would require a lot of memory and processing power, and impact the performance of our code and web page.

### Passing parameters to timeouts

There's an extended way that we can use `setTimeout()`: it's possible to pass the function *additional parameters* beyond the function and the wait time in milliseconds.  These  additional parameters are stored temporarily and used as the parameters  when the function is executed by `setTimeout`.  This can be a useful way to *reuse* a routine with a parameter that changes based on user input.  For  example, this sample code that extends the previous example will "echo"  the text that a user has entered into an input.

<iframe scrolling="no" title="Timeouts with parameters" src="https://codepen.io/exts/embed/566ff1e71c6d9f5a1249f38e0cd1b7e0/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/566ff1e71c6d9f5a1249f38e0cd1b7e0/'&gt;Timeouts
 with parameters&lt;/a&gt; by EPFL Extension School (&lt;a 
href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

It can be a bit difficult to see the benefit of the approach above by just reading the code.  It becomes more obvious when actually running  the code though: this routine allows us to "queue up" several echoes,  which will then update the HTML elements at the appropriate point in the future.  And the fact that the `firstEcho` and `secondEcho` functions have been declared separately from our use of `setTimeout` means that we have modular, organised, well-structured code that can easily be reused anywhere else that we need it.

You can try adjusting the example above to make the timeouts further apart or closer together, or even add a third "echo".

## A recurring event

Now we know a lot about using `setTimeout` in our JavaScript code.  `setTimeout` is used to execute a function *once* in the future.  What about if we wanted to regularly execute that  function repeatedly?  JavaScript includes another function similar to `setTimeout()` that allows us to repeat something over and over again: `setInterval()`.

We use `setInterval` in exactly the same way as `setTimeout`: we pass a function that will be executed, and a delay in milliseconds.  The difference is that when `setInterval` executes the function that it is passed, it will start *a new* timer to execute the function again with the same delay.  It's  important to remember that this happens forever until the browser page  is closed; by using `setInterval`, we introduce an *infinite loop* into our application that is similar to loops we create using `while`.

<iframe scrolling="no" title="Timeouts with parameters" src="https://codepen.io/exts/embed/preview/c73e6eafe41574daa253e14bd62008c6/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/c73e6eafe41574daa253e14bd62008c6/'&gt;Timeouts
 with parameters&lt;/a&gt; by EPFL Extension School (&lt;a 
href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

This example demonstrates two things: first, it shows how similar `setInterval` is to `setTimeout` in usage.  Secondly, it demonstrates that we need to think about how to *stop* `setInterval` from running forever.  The annoying blinking text that is controlled by the `setInterval` loop is a visual example of why we need to be able to control `setInterval`.

There is one simple way to control an interval: we keep hold of a  reference to the interval and use that reference to halt the interval  from repeating further.  Then we are at liberty to restart the interval  whenever it is needed again.

The reference that we need is simpy an integer used to identify the interval timer that has been started.  We can then use the `clearInterval` function, passing it this identifier, to stop the interval.

The identifier is returned by the `setInterval` function.  We assign the return value of `setInterval` to a variable and that gives us the possibility to stop the interval at any point that we want.  Let's see how we can store and use the  interval identifier in this example:

<iframe scrolling="no" title="An interval that can be stopped" src="https://codepen.io/exts/embed/760e868f73e2cbeaa818f3e837fce321/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/760e868f73e2cbeaa818f3e837fce321/'&gt;An
 interval that can be stopped&lt;/a&gt; by EPFL Extension School (&lt;a 
href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on &lt;a 
href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

In this example, the identifier for the interval is assigned to `intervalId`, and this variable is used within the anonymous function bound to the `'#stop'` button.  Pressing the button executes the `clearInterval` method and stops the blinking text.

### Safely stopping and starting intervals

As a final example, let's look at how to manage intervals so that a new interval can *safely* be started after the previous interval has stopped.  This example is  significantly more complex than the previous ones, and makes use of  conditionals.  Have a look and think about why the conditional is needed within the function bound to the `'#restart'` button.

<iframe scrolling="no" title="An interval that can be restarted safely" src="https://codepen.io/exts/embed/24add575f1240a00512202be8dbd303b/?height=300&amp;theme-id=30331&amp;default-tab=js,result&amp;embed-version=2&amp;editable=true" allowtransparency="true" allowfullscreen="true" style="width: 100%;" height="300" frameborder="no">See
 the Pen &lt;a 
href='https://codepen.io/exts/pen/24add575f1240a00512202be8dbd303b/'&gt;An
 interval that can be restarted safely&lt;/a&gt; by EPFL Extension 
School (&lt;a href='https://codepen.io/exts'&gt;@exts&lt;/a&gt;) on 
&lt;a href='https://codepen.io'&gt;CodePen&lt;/a&gt;.
</iframe>

Remove the line `intervalId = 0;` from the function bound to the stop button.  Then see what happens when the restart button is pressed *twice* before the stop button is pressed.

Setting the intervalId to `0` is a way of indicating that there is *no interval currently running* after we clear the interval using `clearInterval`.  By assigning the value of `0`, we're saying "There is no interval currently running".  The conditional in the function bound to the restart button uses this fact: it checks  that there is no interval running and therefore it's safe to start a new interval.  If there is an interval running, then the value of `intervalId` will not be `0`.  Explore the example some more if this routine doesn't make sense  straight away.  It is an important concept to understand in order to use both `setTimeout` and `setInterval`, otherwise your advanced timeouts and intervals will not behave how you intend them to.

### Interrupting timers

There is one last point to make in this unit about scheduling things in JavaScript, and that is that `setTimeout()` returns an identifier in exactly the same way as `setInterval()`, and we can use `clearTimeout` in the same way for *timers* as `clearInterval` is used for *intervals*.  So we have full control over all timers and intervals that we create in JavaScript *provided* we put the safe routines in place.

That's it for scheduling things in JavaScript.  We've seen how to use `setTimeout` to run a *timer* that executes a function after a specific number of milliseconds, and  that we can optionally provide parameters for the function that `setTimeout` will execute.  We've also seen that we can use `setInterval` to run an *interval* that will execute a function repeatedly with a set number of milliseconds between each run.  Finally, we saw that both `setInterval` and `setTimeout` return identifiers that can be used to clear the timer or interval so that it isn't executed any further.backs.