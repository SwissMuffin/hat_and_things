# 15. Making API requests

- ​              [Content](https://learn.extensionschool.ch/learn/programs/web-application-development-v1/subjects/advanced-javascript-techniques-v1/units/making-api-requests-v1#content)            

In this unit, we'll be looking at how we can write code in JavaScript that will "communicate" to other web applications.  In order to do this, we  need to understand the interfaces for this communication: APIs.  We'll  learn what an API is, and how we can make API calls using JavaScript.  Just as a web application may have a user-interface (UI) that  facilitates human-to-application interactions, it may also have an API  to facilitate application-to-application interactions as well.  We'll  also see that we generally use a technique called *AJAX* when  interacting with APIs in JavaScript.  We'll see what the acronym_AJAX_  stands for and that it allows us to make new web requests without  reloading the page in the browser.

## Application Programming Interface

API stands for Application Programming Interface, and the role of an  API is to respond to requests for information or process information  that it is sent, typically in the JSON format that we explored in the  previous unit.   This means that we can write code that will interact  with an API, retrieving and sending data about resources that we need in a structured and automatic way.

#### A simple Example

We can make a simple API request by opening our browser, and navigating to https://jsonplaceholder.typicode.com/users. Doing this will bring us to a page that contains an array full of JSON objects like these:

```json
{
  "id": 3,
  "name": "Clementine Bauch",
  "username": "Samantha",
  "email": "Nathan@yesenia.net",
  "address": {
    "street": "Douglas Extension",
    "suite": "Suite 847",
    "city": "McKenziehaven",
    "zipcode": "59590-4157",
    "geo": {
      "lat": "-68.6102",
      "lng": "-47.0653"
    }
  },
  "phone": "1-463-123-4447",
  "website": "ramiro.info",
  "company": {
    "name": "Romaguera-Jacobson",
    "catchPhrase": "Face to face bifurcated interface",
    "bs": "e-enable strategic applications"
  }
}
```

Let's begin our study of working with APIs by looking at some of the more common terms and components.

## Terminology

#### The resource

"Resource" decribes the information that the API is the interface  for. In the example above, the resource is a collection of user records.

#### The request

This is sometimes referred to as the "call", and it is the term that  describes one of several ways that we make an attempt to communicate  with the API. The request that we made in the example above was a `GET` request, because we were simply "getting" data from the API. Because `GET` is the default request method, we didn't need to explicitly define it  in our request. Let's look at a few of the other request methods:

| Method | Intended use                       |
| ------ | ---------------------------------- |
| GET    | Retrieving a resource              |
| POST   | Creating, or modifying a resource* |
| PUT    | Creating, or modifying a resource* |
| DELETE | Removing a resource                |
| PATCH  | Modifies (part-of) a resource      |

Since the method is just one part of the request, let's look at some of the other components:

| Component      | Description                                                  | Example                                      |
| -------------- | ------------------------------------------------------------ | -------------------------------------------- |
| URI            | The address of the resource                                  | `https://jsonplaceholder.typicode.com/users` |
| Method         | The type of the request                                      | `GET`                                        |
| Headers        | These are additional pieces of information that are sent to the resource | We didn't submit any in our request          |
| Data (or body) | We didn't submit any, but in theory we could have submitted a new record to the resource using a `POST` request | `{ "userName" : "Karl" }`                    |

In our example, the URI is relatively simple, because it contains no  parameters. In this case, the request URI is the same as the "endpoint", which is the term used to describe the access point(s) of an API. We've been looking at the "users" endpoint of the JSON Placeholder API, which is found at `https://jsonplaceholder.typicode.com/users`, but the JSON Placeholder API has other endpoints as well.

#### The response

When working with APIs, the "response" is what the API comes back to  us with, after we make our request. In an ideal case, this might be the  information that we are requesting, but it could also be an error,  telling us that there was a problem with our request. For example: the  JSON Placeholder API also has a "comments" endpoint, which gives us  access to records that resemble typical comments on blog or social media posts. If we made a `GET` request to the "comments" endpoint, using https://jsonplaceholder.typicode.com/comments, the normal response would be an array of "comment" records that look more-or-less like this one:

```js
{
  "postId": 2,
  "id": 7,
  "name": "repellat consequatur praesentium vel minus molestias voluptatum",
  "email": "Dallas@ole.me",
  "body": "maiores sed dolores similique labore et inventore et\nquasi temporibus esse sunt id et\neos voluptatem aliquam\naliquid ratione corporis molestiae mollitia quia et magnam dolor"
}
```

#### Request parameters

Just as we can pass parameters to functions, we can also pass  parameters to our API requests. For example, we the "comments" endpoint  allows us to send it the `postId` as a parameter.  `postId` represents the identifier of the blog post that the comment is attached to.  So we can use `postId` to filter the response to contain only those resources that are associated with the `postId` that we send it.

For example, the adding the parameter `?postId=3` like this --https://jsonplaceholder.typicode.com/comments?postId=3 --will filter the response to only comments that were made on blog post number `3`.

If an API accepts other parameters, we can add these to the full URI as well, separating them with the `&` symbol.

## AJAX and `XMLHttpRequest()`

Up until now, we have been making `GET` requests by navigating in our browsers to the API URI, but let's explore how we can use `XMLHttpRequest()` to make an API request from our JavaScript code.

```js
let request = new XMLHttpRequest(); // Creates a new instance of the XMLHttpRequest object
```

Let's take a moment to talk about *AJAX*.  The XMLHttpRequest is used to create a web request that is performed using the technique called *AJAX*, which is an acronym for *Asynchronous JavaScript and XML*.

AJAX is a technique for using JavaScript to make a web request *asynchronously*.  A request sent using AJAX will not need to reload the whole browser  page and we use it to retrieve specific data that a page needs from  APIs.  The *asynchronous* part means that the page does *not* wait for the response for the request; the page continues executing  other JavaScript and when the server sends back the response data we can then act on it.  This is useful because we can write a script that asks for some data, then carry on responding to the interactions of the user instead of *blocking everything* while we wait for the response.  This asynchronous behaviour is why AJAX became so popular as a  technique for creating fast-reacting user interfaces that load new data  from the server.

What about the *XML* part of AJAX?  Originally, the data  format used in AJAX request was XML, which is a broad standard of markup language similar to HTML.  [XML stands for *extensible markup language*](https://en.wikipedia.org/wiki/XML).  XML was a very popular format for transporting data when AJAX was  first used, but it has been superseded by JSON as the data format of  choice when we use AJAX.  So the *X* in AJAX is a legacy term from it's early days.

That's all we need to know about AJAX - that is the technique to describe what the `XMLHttpRequest` object is for.  So let's get back to our request code.

#### Making the request

We just declared a new variable, named `request`, which is a special type of JavaScript object that has certain methods  attached to it that we will use to make our API request. We'll need to  initialize our request by calling the `open()` method, and submitting our request type, and URI.

```js
request.open('GET', 'https://jsonplaceholder.typicode.com/users'); // XMLHttpRequest.open(method, URI)
```

The line of code establishes the API request, which is a `GET` request to the `https://jsonplaceholder.typicode.com/users` endpoint. We can also set another property of the `request` object to a function that will be run as soon as our response is received.

```js
request.onload = () => {
  console.log(request.responseText); // the response will be logged once it is received
}
```

We can now make the request, using the `.send()` method.

```js
let request = new XMLHttpRequest();
request.open('GET', 'https://jsonplaceholder.typicode.com/users'); // initializes the request
request.onload = () => {
  console.log(request.responseText); // logs the response once the response is received
}
request.send();
```

And there we have it; we just made a sucessful API `GET` request from our code. However; we'll still need to use `JSON.parse()` on our response text, if we want to be able to interact with it as an object in our code.

```js
request.onload = () => {
  console.log(JSON.parse(request.responseText)); // logs Array [ {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…} ]
}
```

#### Doing something with the response

Instead of simply logging the response in the console, we can use the `.onload()` function to insert the contents of the response into the DOM as an HTML list. To do that, we'll have to parse the JSON response so that we can  iterate over it as an actual JavaScript array. Once we've done that, we  can loop through that array, and create a list item for each object in  the response array.

```js
request.onload = () => {
  let data = JSON.parse(request.responseText); // parses the array of user objects

  let list = document.createElement('ul'); // creates a new list element

  for (var i = 0; i < data.length; i++) { // loops through each user object
    let li = document.createElement('li'); // creates a new list-item element

    li.innerHTML = data[i].username; // sets the list item's content to the username property

    list.appendChild(li); // attaches the list-item to the list
  }

  document.body.appendChild(list); // inserts the list into the DOM
}
```

Refreshing the browser now will render the following list of usernames in the document body:

- Bret
- Antonette
- Samantha
- Karianne
- Kamren
- Leopoldo_Corkery
- Elwyn.Skiles
- Maxime_Nienow
- Delphine
- Moriah.Stanton

## `fetch()`

`XMLHttpRequest` is fairly verbose, so thankfully, a more modern API was introduced: `fetch()`. Fetch is more flexible and powerful than `XMLHttpRequest`, and it's syntax is easier to navigate as well. For example, let's refactor our previous example to use `fetch()`:

```js
fetch('https://jsonplaceholder.typicode.com/users')
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(myJson); // logs Array [ {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…}, {…} ]
  });
```

The syntax above uses a technique known as "chaining", or  "cascading", where methods are called directly after each other. Using `fetch()` this way also enables us to avoid the need to parse the response, which is more convenient and direct.

------

There is more to `fetch()` and `XMLHttpRequest` than just what we've looked at in this unit, including ways to check  the status of the request, and handling any errors that occur during the request. So far, we have explored what an API is --and what the  components of an API request are. We also used the `XMLHttpRequest` object to make a request, and we inserted part of the request's `responseText` into the DOM.

APIs are the way that modern web applications interface with each  other, and knowing how to make use of them is incredibly powerful. For  more reading about APIs, consider starting with MDN's [Introduction to web APIs](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Client-side_web_APIs/Introduction).